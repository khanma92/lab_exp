<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8" />
    <title>Anthrope</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../../public/assets/css/loaders/loader-typing.css" rel="stylesheet" type="text/css" media="all" />
    <script src="../../libraries/utils.js"></script>
    <script src="../../libraries/FontLoader.js"></script>
    <link rel="preload" as="font" href="../../public/assets/fonts/Inter-UI-upright.var.woff2" type="font/woff2"
        crossorigin="anonymous">

    <link href="../../public/assets/css/custom.css" rel="stylesheet" type="text/css" media="all" />
    <link href="../../public/assets/css/theme.css" rel="stylesheet" type="text/css" media="all" />

    <!-- load vegalite libraries -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5.12.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4.13.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.8.0"></script>
</head>

<body class="is-preload">
    <%- include('../partials/menu_bar_viz') %>

        <!-- main section text  -->
        <section class="bg-primary-alt header-inner o-hidden pt-7">
            <div class="container">
                <div class="row py-6 text-center justify-content-center align-items-center layer-2">
                    <div class="col-xl-8 col-lg-10">
                        <h1 class="display-4">What is your personality?</h1>
                        <p id="no-data-text" class="lead mb-1"></p><br>
                        <p class="lead mb-0">

                            What makes you who you are? What are the fundamental characteristics that make each person
                            unique? Decades of scientific research have shown that people can be described by the <a
                                href="https://en.wikipedia.org/wiki/Big_Five_personality_traits" target="_blank">'Big
                                Five' dimensions</a>: openness, conscientiousness, extraversion, agreeableness, and
                            neuroticism (OCEAN).
                            <br><br>
                            The survey you just completed measures not only these five dimensions but also further
                            divides each dimension into two <a href='https://psycnet.apa.org/buy/2007-15390-012'
                                target="_blank">sub-dimensions</a>. Check out the interactive results below and help
                            spread the word.
                        </p><br>

                        <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.anthrope.me"
                            target="_blank"><img class="share-button"
                                src="../../public/assets/img/icons/social/facebook.svg" data-inject-svg /></a>
                        <a href="https://twitter.com/intent/tweet?text=Check%20out%20@anthrope_me%20https://www.anthrope.me"
                            target="_blank"><img class="share-button"
                                src="../../public/assets/img/icons/social/twitter.svg" data-inject-svg /></a>
                        <a href="" onclick="copyURI(event,link)"><img class="share-button"
                                src="../../public/assets/img/icons/theme/general/clipboard.svg" data-inject-svg /></a>
                        <br><br>
                    </div>
                </div>
            </div>
            <div class="divider layer-1">
                <img src="../../public/assets/img/dividers/divider-2.svg" alt="graphical divider" data-inject-svg />
            </div>
        </section>

        <!-- main/first figure id="vis1"  -->
        <section>
            <div class="container">

                <div class="row align-items-center justify-content-around">

                    <div class="col-auto col-xl-6">
                        <div id="vis1" class="center"></div>
                    </div>

                    <div class="col-auto col-xl-6">
                        <div class="row justify-content-center">
                            <div class="col-xl-10 col-lg-11">
                                <span id="no-data-tag0" class="badge badge-primary"></span>
                                <div class="my-2">
                                    <span class="h4">Big Five dimensions</span>
                                </div>
                                <p class="lead">
                                    Each slice of the pie is one Big Five dimension. The five slices are <strong>OCEAN:
                                    </strong> <strong>o</strong>penness, <strong>c</strong>onscientiousness,
                                    <strong>e</strong>xtraversion, <strong>a</strong>greeableness,
                                    <strong>n</strong>euroticism. Larger and taller slices indicate higher scores on a
                                    dimension. Scores range from 1 to 5.
                                </p>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </section>

        <!-- next section -->
        <!-- icons reference: https://leap.mediumra.re/elements-icons-reference.html -->
        <section class="pt-0 has-divider">
            <div class="container pt-1">
                <div class="row mb-4" data-aos="fade-up">
                    <div class="col">
                        <h2>What do these results mean?</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-md d-flex mb-3 mb-md-0" data-aos="fade-up" data-aos-delay="100">
                        <img class="icon icon-md bg-primary"
                            src="../../public/assets/img/icons/theme/design/zoom-plus.svg" alt="zoom-plus icon"
                            data-inject-svg />
                        <div class="ml-3">
                            <h5>Self-control and impulsivity</h5>
                            <p>
                                People who are more conscientious tend to have higher <a href="#">self-control</a> or <a
                                    href="/surveys/gritshort">grit</a> and may be less likely to <a
                                    href='/tasks/delaydiscount/'>discount future rewards</a>.
                            </p>
                        </div>
                    </div>
                    <div class="col-12 col-md d-flex mb-3 mb-md-0" data-aos="fade-up" data-aos-delay="200">
                        <img class="icon icon-md bg-primary"
                            src="../../public/assets/img/icons/theme/design/zoom-plus.svg" alt="zoom-plus icon"
                            data-inject-svg />
                        <div class="ml-3">
                            <h5>Openness and receptivity</h5>
                            <p>
                                Openness is often associated with increased <a href='#'>creativity</a> and greater <a
                                    href='/surveys/brs1/'>receptivity</a> to new or different experiences. It may also
                                be related to <a href='#'>cognitive flexibility</a>.
                            </p>
                        </div>
                    </div>
                    <div class=" col-12 col-md d-flex mb-3 mb-md-0" data-aos="fade-up" data-aos-delay="300">
                        <img class="icon icon-md bg-primary"
                            src="../../public/assets/img/icons/theme/design/zoom-plus.svg" alt="zoom-plus icon"
                            data-inject-svg />
                        <div class="ml-3">
                            <h5>Your values</h5>
                            <p>
                                People in different cultures not only score differently on the Big Five dimensions but
                                also have very different <a href='/surveys/schulzvalues2019/'>fundamental values,
                                    beliefs, and world views</a>.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="divider">
                <img class="bg-primary-alt" src="../../public/assets/img/dividers/divider-1.svg" alt="divider graphic"
                    data-inject-svg />
            </div>
        </section>


        <section class="bg-primary-alt viz-subsections">
            <div class="container">
                <div class="row justify-content-center mb-4">
                    <div class="col-lg-10 col-xl-8 text-center">
                        <h2 class="h1">More visualizations</h2>
                    </div>
                </div>

                <div class="container">
                    <div class="row align-items-center justify-content-around">
                        <div class="col-auto col-xl-6">
                            <div id="vis2" class="center"></div>
                        </div>

                        <div class="col-auto col-xl-6">
                            <div class="row justify-content-center">
                                <div class="col-xl-10 col-lg-11 ml-auto">
                                    <span id="no-data-tag1" class="badge badge-primary"></span>
                                    <div class="my-2">
                                        <span class="h4">10 Big Five sub-dimensions</span>
                                    </div>
                                    <p class="lead mb-2"></p>
                                    <p class="lead">
                                        Each Big Five dimension can be broken down into 2 sub-dimensions. To remember
                                        the Big Five dimensions, use the <strong>OCEAN</strong> acronym: </strong>
                                        <strong>o</strong>penness, <strong>c</strong>onscientiousness,
                                        <strong>e</strong>xtraversion, <strong>a</strong>greeableness,
                                        <strong>n</strong>euroticism.
                                    </p>
                                    <p class="lead">
                                        Scores range from 1 to 5. Hover over the bars to see the average score. Hover
                                        over the dot to see your score. The very last bar indicates the variance across
                                        all dimensions.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="container pt-7">
                    <div class="row align-items-center justify-content-around">
                        <div class="col-auto col-xl-6">
                            <div id="vis3" class="center"></div>
                        </div>
                        <div class="col-auto col-xl-6">
                            <div class="row justify-content-center">
                                <div class="col-xl-10 col-lg-11 ml-auto">
                                    <span class="badge badge-primary">Gender differences</span>
                                    <div class="my-2">
                                        <span class="h4">Openness</span>
                                    </div>
                                    <p class="lead">
                                        Openness is how open-minded you are. Open-minded people enjoys trying new
                                        things. They appreciate art, emotion, adventure, unusual ideas, imagination,
                                        curiosity, and different experiences.

                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container pt-7">
                    <div class="row align-items-center justify-content-around">
                        <div class="col-auto col-xl-6">
                            <div id="vis4" class="center"></div>
                        </div>
                        <div class="col-auto col-xl-6">
                            <div class="row justify-content-center">
                                <div class="col-xl-10 col-lg-11 ml-auto">
                                    <span class="badge badge-primary">Gender differences</span>
                                    <div class="my-2">
                                        <span class="h4">Concientiousness</span>
                                    </div>
                                    <p class="lead">
                                        Conscientiousness is how much self-discipline and self-control you have. People
                                        who score high on this dimension tend to act dutifully and are good at
                                        regulating and directing their impulses. They also prefer planned rather than
                                        spontaneous activities.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container pt-7">
                    <div class="row align-items-center justify-content-around">
                        <div class="col-auto col-xl-6">
                            <div id="vis5" class="center"></div>
                        </div>
                        <div class="col-auto col-xl-6">
                            <div class="row justify-content-center">
                                <div class="col-xl-10 col-lg-11 ml-auto">
                                    <span class="badge badge-primary">Gender differences</span>
                                    <div class="my-2">
                                        <span class="h4">Extraversion</span>
                                    </div>
                                    <p class="lead">
                                        Extraversion reflects how much you prefer to enagage with the external world.
                                        Extraverts (higher scores) enjoy interacting with people and often come across
                                        as full of energy. They also like to assert themselves.
                                    </p>
                                    <p class='lead'>
                                        Introverts (lower scores), however, engage less socially and need less external
                                        stimulation. Thus, introverts tend to be more reserved than extraverts
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container pt-7">
                    <div class="row align-items-center justify-content-around">
                        <div class="col-auto col-xl-6">
                            <div id="vis6" class="center"></div>
                        </div>
                        <div class="col-auto col-xl-6">
                            <div class="row justify-content-center">
                                <div class="col-xl-10 col-lg-11 ml-auto">
                                    <span class="badge badge-primary">Gender differences</span>
                                    <div class="my-2">
                                        <span class="h4">Agreeableness</span>
                                    </div>
                                    <p class="lead">
                                        Agreeable people (higher scores) value social harmony and try to get along well
                                        with others. They are willing to compromise their interests with others.
                                    </p>
                                    <p class='lead'>
                                        Disagreeable people (lower scores) tend to be more self-interested and
                                        unconcerned about others' well-being.
                                    </p>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container pt-7">
                    <div class="row align-items-center justify-content-around">
                        <div class="col-auto col-xl-6">
                            <div id="vis7" class="center"></div>
                        </div>
                        <div class="col-auto col-xl-6">
                            <div class="row justify-content-center">
                                <div class="col-xl-10 col-lg-11 ml-auto">
                                    <span class="badge badge-primary">Gender differences</span>
                                    <div class="my-2">
                                        <span class="h4">Neuroticism</span>
                                    </div>
                                    <p class="lead">
                                        Neuroticism measures emotional instability. People with higher scores tend to
                                        experience more negative emotions and are more reactive and vulnerable to
                                        stress. They might be worse are regulating their emotions and experience more
                                        stress and anxiety in their lives.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container pt-7">
                    <div class="row align-items-center justify-content-around">
                        <div class="col-auto col-xl-6">
                            <div id="vis8" class="center"></div>
                        </div>
                        <div class="col-auto col-xl-6">
                            <div class="row justify-content-center">
                                <div class="col-xl-10 col-lg-11 ml-auto">
                                    <span class="badge badge-primary">Correlation</span>
                                    <div class="my-2">
                                        <span class="h4">Associations between dimensions</span>
                                    </div>
                                    <p class="lead">
                                        Although the Big Five dimensions are distinct and generally quite independent of
                                        each other, they often correlate with each other slightly. The heatmap shows the
                                        correlations. Brighter colors are more positive correlations and darker colours
                                        are more negative correlations.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container pt-7">
                    <div class="row align-items-center justify-content-around">
                        <div class="col-auto col-xl-6">
                            <div id="vis9" class="center"></div>
                        </div>
                        <div class="col-auto col-xl-6">
                            <div class="row justify-content-center">
                                <div class="col-xl-10 col-lg-11 ml-auto">
                                    <span class="badge badge-primary">Global choropleth</span>
                                    <div class="my-2">
                                        <span class="h4">Global Big Five dimension</span>
                                    </div>
                                    <p class="lead">
                                        Hover over the map to see the average score for different countries. Only one
                                        Big Five dimension is shown. To see another (randomly selected) dimension,
                                        refresh this page.
                                    </p>
                                    <p class="lead">If you find the results interesting, tell your friends from other
                                        countries to complete this task.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </section>

        <!-- final section: link to other tasks -->
        <section>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-xl-10">

                        <h2 class="mb-4">Curious? Complete another one.</h2>
                        <div class="row no-gutters mb-3 d-none d-md-flex py-0">
                            <div class="col-xl-8 col-lg-7 col-md-6">
                                <span class="text-small text-muted"></span>
                            </div>
                            <div class="col">
                                <span class="text-small text-muted">Estimated time</span>
                            </div>
                        </div>

                        <div class="list-group list-group-flush">
                            <a href="/tasks/stroop" class="list-group-item list-group-item-action row no-gutters">
                                <div class="col-xl-8 col-lg-7 col-md-6">
                                    <h5 class="mb-0">How well can you control your attention?</h5>
                                </div>
                                <div class="col-md">
                                    <span>5-8 min</span>
                                </div>
                            </a>
                            <a href="/surveys/gritshort"
                                class="list-group-item list-group-item-action row no-gutters py-2">
                                <div class="col-xl-8 col-lg-7 col-md-6">
                                    <h5 class="mb-0">How gritty are you?</h5>
                                </div>
                                <div class="col-md">
                                    <span>1-3 min</span>
                                </div>
                            </a>
                            <a href="/surveys/schulzvalues2019/"
                                class="list-group-item list-group-item-action row no-gutters py-2">
                                <div class="col-xl-8 col-lg-7 col-md-6">
                                    <h5 class="mb-0">What are your fundamental values?</h5>
                                </div>
                                <div class="col-md">
                                    <span>4-6 min</span>
                                </div>
                            </a>
                        </div>

                        <span class="d-block mt-4"><a href="/tasks" class="hover-arrow">See more tasks</a>
                        </span>

                    </div>
                </div>
            </div>
        </section>




















        <!-- specify vegalite figures below -->

        <script type="text/javascript">
            // data from database
            const data_array = <%- JSON.stringify(data_array) %>;
            const country_array = <%- JSON.stringify(country_array) %>;
            const matrix_array = <%- JSON.stringify(matrix_array) %>;
            const choropleth_filter = country_array[0].subscale;
            const link = window.location.origin + <%- JSON.stringify(parent_path) %> + '/viz';

            const parameters = get_query_string()
            if (parameters.id && parameters.time) {
                var subject_id = parameters.id
                var latest_entry_time = parameters.time;
                var subject_data = data_array.filter(i => i.match == true);
                var pie_data = subject_data;
            }
            else {
                // get subject_id from localStorage (null if doesn't exist)
                // subject_id and time will be used to filter arrays for plotting subject data
                var subject_id = get_viz_subject_info(<%- JSON.stringify(parent_path) %>, 2);
                if (subject_id) {
                    var subject_data = data_array.filter(i => i.subject == subject_id);
                    var latest_entry_time = Math.max(...subject_data.map(i => i.time));
                    var subject_data = subject_data.filter(i => i.time == latest_entry_time)
                    var pie_data = subject_data;
                }

            }

        </script>


        <!-- Subscale response radial graph -->
        <script type="text/javascript" defer>
            if (!subject_data) {
                var pie_data = data_array;
            }

            console.log(pie_data)

            var subscale_radial = {
                config: { axis: { labelFontSize: 18, titleFontSize: 12, labelFont: "Inter-UI-upright", titleFont: "Inter-UI-upright" }, title: { fontSize: 28 }, legend: { labelFontSize: 14, labelFont: "Inter-UI-upright", offset: -50 } },
                $schema: "https://vega.github.io/schema/vega-lite/v4.json",
                width: 360,
                height: 360,
                data: {
                    values: pie_data.filter(i => i.param == 'subscale2')
                },
                layer: [
                    {
                        mark: { type: "arc", innerRadius: 20, stroke: "#fff" }
                    },
                    {
                        mark: { type: "text", radiusOffset: 30, fontSize: 24 },
                        encoding:
                        {
                            text: { aggregate: "median", field: "value", type: "quantitative" },
                            // text: { field: "subscale", type: "nominal" },
                        }
                    }
                ],
                encoding: {
                    theta: { aggregate: "median", field: "value", type: "quantitative", stack: true },
                    radius: { aggregate: "median", field: "value", type: "quantitative", scale: { type: "sqrt", zero: true } },
                    color: {
                        field: "subscale",
                        type: "nominal",
                        legend: { title: 'Big five', titleFontSize: 21, labelFontSize: 16, offset: 40 },
                        sort: ["openness", "conscientiousness", "extraversion", "agreeableness", "neuroticism"],
                        scale: { scheme: "set1" }
                    }
                },
                view: { stroke: null },  // border around plot
            };

        </script>






        <!-- Subscale box plot -->
        <script type="text/javascript" defer>

            var subscale_boxplot = {
                config: { axis: { labelFontSize: 18, titleFontSize: 21, labelFont: "Inter-UI-upright", titleFont: "Inter-UI-upright" }, title: { fontSize: 28 }, legend: { labelFontSize: 30, labelFont: "Inter-UI-upright" } },
                "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
                background: "#f3f5fb",
                layer: [
                    {
                        data: { values: data_array },
                        mark: { type: "boxplot", extent: 1.5, opacity: 0.7, tooltip: true, median: { color: "black" } },
                        encoding: {
                            y: {
                                field: "value",
                                type: "quantitative",
                                axis: { "title": "Score" },
                                // scale: { domain: [0, 7] }
                            },
                            x: {
                                field: "subscale",
                                sort: ["openness", "openness-intellect", "openness-openness", "conscientiousness", "conscientiousness-industriousness", "conscientiousness-orderliness", "extraversion", "extraversion-assertiveness", "extraversion-enthusiasm", "agreeableness", "agreeableness-compassion", "agreeableness-politeness", "neuroticism", "neuroticism-volatility", "neuroticism-withdrawal"],
                                type: "ordinal",
                                axis: {
                                    // labelExpr: "datum.value[0] + slice(datum.value, indexof(datum.value, '-'), length(datum.value))"
                                    labelExpr: "if((indexof(datum.value, '-') != -1), (datum.value[0] + slice(datum.value, indexof(datum.value, '-'), length(datum.value))), if(datum.value == 'variance', datum.value, datum.value[0]))",
                                    title: null,
                                },
                            },
                            size: { value: 18 },
                            color: { field: "subscale", legend: null, scale: { scheme: "viridis" }, type: "nominal", scale: { scheme: "viridis" } },
                            tooltip: [
                                { field: 'value', type: "quantitative", format: '.1f', title: "Response", aggregate: "mean" }
                            ]
                        }
                    },
                    {
                        // data: { values: data_array.filter(i => i.subject == subject_id && i.time == start_time) },
                        data: (function () { // anonymous function
                            if (subject_id) {
                                return { values: data_array.filter(i => i.subject == subject_id && i.time == latest_entry_time) };
                            } else {  // don't draw vertical rule
                                return { values: [] };
                            }
                        }()),
                        mark: { type: "point", tooltip: true, filled: true, color: "firebrick" },
                        encoding: {
                            x: {
                                field: "subscale",
                                sort: ["openness", "openness-intellect", "openness-openness", "conscientiousness", "conscientiousness-industriousness", "conscientiousness-orderliness", "extraversion", "extraversion-assertiveness", "extraversion-enthusiasm", "agreeableness", "agreeableness-compassion", "agreeableness-politeness", "neuroticism", "neuroticism-volatility", "neuroticism-withdrawal"],
                                type: "ordinal",
                            },
                            y: { field: "value", type: "quantitative" },
                            size: { value: 150 },
                            tooltip: [{ field: "value", format: ".1f", title: 'Your score', type: "quantitative" }] // format tooltip
                        },
                    }
                ],
                width: 500,
                height: 400,
            };

        </script>




        <!-- Openness density -->
        <script type="text/javascript" defer>

            var openness_density = {
                config: { axis: { labelFontSize: 18, titleFontSize: 12, labelFont: "Inter-UI-upright", titleFont: "Inter-UI-upright" }, title: { fontSize: 28 }, legend: { labelFontSize: 14, labelFont: "Inter-UI-upright" } },
                "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
                background: "#f3f5fb",
                layer: [
                    {
                        data: { values: data_array.filter(x => x.subscale == 'openness') },
                        transform: [{ groupby: ["gender"], density: "value" }],
                        mark: { type: "area", color: "#3755be", opacity: 0.5, tooltip: true },
                        encoding: {
                            x: {
                                type: "quantitative",
                                field: "value",
                                title: "Openness",
                                scale: {}
                            },
                            y: {
                                type: "quantitative",
                                field: "density",
                                title: "Frequency (density)",
                            },
                            color: { field: "gender", type: "nominal", legend: { title: null }, scale: { scheme: "set1" } },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Openness', type: "quantitative" },
                                { field: 'density', title: 'Density', type: "quantitative", format: ".4f" }]
                        }
                    },
                    {
                        data: (function () { // anonymous function
                            if (subject_id) { // if subject_id exists, retrieve data and draw vertical line
                                return { values: subject_data.filter(i => i.subscale == "openness") };
                            } else {  // don't draw vertical rule
                                return { values: [] };
                            }
                        }()),
                        mark: { type: "rule", opacity: 0.5 },
                        encoding: {
                            x: { aggregate: "mean", field: "value", type: "quantitative" },
                            color: { value: "#080808", type: "quantitative" },
                            size: { value: 3 },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Your score', type: "quantitative" }]
                        },
                    }
                ],
                width: 500,
                height: 400,
            };

        </script>


        <!-- Conscientiousness density -->
        <script type="text/javascript" defer>

            var conscientiousness_density = {
                config: { axis: { labelFontSize: 18, titleFontSize: 12, labelFont: "Inter-UI-upright", titleFont: "Inter-UI-upright" }, title: { fontSize: 28 }, legend: { labelFontSize: 14, labelFont: "Inter-UI-upright" } },
                "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
                background: "#f3f5fb",
                layer: [
                    {
                        data: { values: data_array.filter(x => x.subscale == 'conscientiousness') },
                        transform: [{ groupby: ["gender"], density: "value" }],
                        mark: { type: "area", color: "#3755be", opacity: 0.5, tooltip: true },
                        encoding: {
                            x: {
                                type: "quantitative",
                                field: "value",
                                title: "Conscientiousness",
                                scale: {}
                            },
                            y: {
                                type: "quantitative",
                                field: "density",
                                title: "Frequency (density)",
                            },
                            color: { field: "gender", type: "nominal", legend: { title: null }, scale: { scheme: "set1" } },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Conscientiousness', type: "quantitative" },
                                { field: 'density', title: 'Density', type: "quantitative", format: ".4f" }]
                        }
                    },
                    {
                        data: (function () { // anonymous function
                            if (subject_id) { // if subject_id exists, retrieve data and draw vertical line
                                return { values: subject_data.filter(i => i.subscale == "conscientiousness") };
                            } else {  // don't draw vertical rule
                                return { values: [] };
                            }
                        }()),
                        mark: { type: "rule", opacity: 0.5 },
                        encoding: {
                            x: { aggregate: "mean", field: "value", type: "quantitative" },
                            color: { value: "#080808", type: "quantitative" },
                            size: { value: 3 },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Your score', type: "quantitative" }]
                        },
                    }
                ],
                width: 500,
                height: 400,
            };

        </script>


        <!-- Extraversion density -->
        <script type="text/javascript" defer>

            var extraversion_density = {
                config: { axis: { labelFontSize: 18, titleFontSize: 12, labelFont: "Inter-UI-upright", titleFont: "Inter-UI-upright" }, title: { fontSize: 28 }, legend: { labelFontSize: 14, labelFont: "Inter-UI-upright" } },
                "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
                background: "#f3f5fb",
                layer: [
                    {
                        data: { values: data_array.filter(x => x.subscale == 'extraversion') },
                        transform: [{ groupby: ["gender"], density: "value" }],
                        mark: { type: "area", color: "#3755be", opacity: 0.5, tooltip: true },
                        encoding: {
                            x: {
                                type: "quantitative",
                                field: "value",
                                title: "Extraversion",
                                scale: {}
                            },
                            y: {
                                type: "quantitative",
                                field: "density",
                                title: "Frequency (density)",
                            },
                            color: { field: "gender", type: "nominal", legend: { title: null }, scale: { scheme: "set1" } },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Extraversion', type: "quantitative" },
                                { field: 'density', title: 'Density', type: "quantitative", format: ".4f" }]
                        }
                    },
                    {
                        data: (function () { // anonymous function
                            if (subject_id) { // if subject_id exists, retrieve data and draw vertical line
                                return { values: subject_data.filter(i => i.subscale == "extraversion") };
                            } else {  // don't draw vertical rule
                                return { values: [] };
                            }
                        }()),
                        mark: { type: "rule", opacity: 0.5 },
                        encoding: {
                            x: { aggregate: "mean", field: "value", type: "quantitative" },
                            color: { value: "#080808", type: "quantitative" },
                            size: { value: 3 },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Your score', type: "quantitative" }]
                        },
                    }
                ],
                width: 500,
                height: 400,
            };

        </script>


        <!-- Agreeableness density -->
        <script type="text/javascript" defer>

            var agreeableness_density = {
                config: { axis: { labelFontSize: 18, titleFontSize: 12, labelFont: "Inter-UI-upright", titleFont: "Inter-UI-upright" }, title: { fontSize: 28 }, legend: { labelFontSize: 14, labelFont: "Inter-UI-upright" } },
                "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
                background: "#f3f5fb",
                layer: [
                    {
                        data: { values: data_array.filter(x => x.subscale == 'agreeableness') },
                        transform: [{ groupby: ["gender"], density: "value" }],
                        mark: { type: "area", color: "#3755be", opacity: 0.5, tooltip: true },
                        encoding: {
                            x: {
                                type: "quantitative",
                                field: "value",
                                title: "Agreeableness",
                                scale: {}
                            },
                            y: {
                                type: "quantitative",
                                field: "density",
                                title: "Frequency (density)",
                            },
                            color: { field: "gender", type: "nominal", legend: { title: null }, scale: { scheme: "set1" } },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Agreeableness', type: "quantitative" },
                                { field: 'density', title: 'Density', type: "quantitative", format: ".4f" }]
                        }
                    },
                    {
                        data: (function () { // anonymous function
                            if (subject_id) { // if subject_id exists, retrieve data and draw vertical line
                                return { values: subject_data.filter(i => i.subscale == "agreeableness") };
                            } else {  // don't draw vertical rule
                                return { values: [] };
                            }
                        }()),
                        mark: { type: "rule", opacity: 0.5 },
                        encoding: {
                            x: { aggregate: "mean", field: "value", type: "quantitative" },
                            color: { value: "#080808", type: "quantitative" },
                            size: { value: 3 },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Your score', type: "quantitative" }]
                        },
                    }
                ],
                width: 500,
                height: 400,
            };

        </script>


        <!-- Neuroticism density -->
        <script type="text/javascript" defer>

            var neuroticism_density = {
                config: { axis: { labelFontSize: 18, titleFontSize: 12, labelFont: "Inter-UI-upright", titleFont: "Inter-UI-upright" }, title: { fontSize: 28 }, legend: { labelFontSize: 14, labelFont: "Inter-UI-upright" } },
                "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
                background: "#f3f5fb",
                layer: [
                    {
                        data: { values: data_array.filter(x => x.subscale == 'neuroticism') },
                        transform: [{ groupby: ["gender"], density: "value" }],
                        mark: { type: "area", color: "#3755be", opacity: 0.5, tooltip: true },
                        encoding: {
                            x: {
                                type: "quantitative",
                                field: "value",
                                title: "Neuroticism",
                                scale: {}
                            },
                            y: {
                                type: "quantitative",
                                field: "density",
                                title: "Frequency (density)",
                            },
                            color: { field: "gender", type: "nominal", legend: { title: null }, scale: { scheme: "set1" } },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Neuroticism', type: "quantitative" },
                                { field: 'density', title: 'Density', type: "quantitative", format: ".4f" }]
                        }
                    },
                    {
                        data: (function () { // anonymous function
                            if (subject_id) { // if subject_id exists, retrieve data and draw vertical line
                                return { values: subject_data.filter(i => i.subscale == "neuroticism") };
                            } else {  // don't draw vertical rule
                                return { values: [] };
                            }
                        }()),
                        mark: { type: "rule", opacity: 0.5 },
                        encoding: {
                            x: { aggregate: "mean", field: "value", type: "quantitative" },
                            color: { value: "#080808", type: "quantitative" },
                            size: { value: 3 },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Your score', type: "quantitative" }]
                        },
                    }
                ],
                width: 500,
                height: 400,
            };

        </script>


        <!-- Correlation heatmap -->
        <script type="text/javascript" defer>

            var correlation_heatmap = {
                config: { axis: { labelExpr: "datum.label[0]", title: null, grid: true, tickBand: "extent", labelFontSize: 18, titleFontSize: 21, labelFont: "Inter-UI-upright", titleFont: "Inter-UI-upright" }, title: { fontSize: 28 }, legend: { labelFontSize: 13, labelFont: "Inter-UI-upright" }, padding: { left: 60 } },
                "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
                background: "#f3f5fb",
                // position: 5000,
                layer: [
                    {
                        data: { values: matrix_array },
                        mark: { type: "rect", tooltip: true },
                        width: 280,
                        height: 280,
                        encoding: {
                            x: {
                                type: "ordinal",
                                field: "x",
                                sort: ["openness", "conscientiousness", "extraversion", "agreeableness", "neuroticism"]
                            },
                            y: {
                                type: "ordinal",
                                field: "y",
                                sort: ["openness", "conscientiousness", "extraversion", "agreeableness", "neuroticism"]
                            },
                            color: { field: "value", type: "quantitative", title: "Correlation", legend: { gradientLength: 100 }, scale: { scheme: "magma" } },
                            tooltip: [
                                { field: 'value', format: ".1f", title: 'Correlation', type: "quantitative" },
                            ]
                        }
                    },
                    {
                        mark: { type: "text", fontSize: 18 },
                        encoding: {
                            text: { field: "value", type: "quantitative" }
                        }
                    }
                ],
            };

        </script>



        <!-- Global response mean choropleth -->
        <script defer>
            var global_mean_plot = {
                $schema: "https://vega.github.io/schema/vega-lite/v4.json",
                config: { axis: { labelFontSize: 18, titleFontSize: 21, labelFont: "Inter-UI-upright", titleFont: "Inter-UI-upright" }, title: { fontSize: 28 }, legend: { labelFontSize: 12, labelFont: "Inter-UI-upright" }, view: { stroke: "transparent" } },
                background: "#f3f5fb",
                width: 600,
                height: 400,
                layer: [
                    {
                        data: {
                            url: "../../public/data/countries-110m.json",
                            format: {
                                type: "topojson",
                                feature: "countries"
                            }
                        },
                        projection: {
                            type: "mercator", scale: 98, center: [0, 40]
                        },
                        mark: {
                            type: "geoshape",
                            fill: "#080808",
                            stroke: "white"
                        },
                        encoding: {
                            tooltip: { field: "properties.name", title: "Country", type: "nominal" }
                        }
                    },
                    {
                        data: {
                            url: "../../public/data/countries-110m.json",
                            format: {
                                type: "topojson",
                                feature: "countries"
                            }
                        },
                        transform: [
                            {
                                lookup: "id",
                                from: {
                                    data: { values: country_array },
                                    key: "country_code",
                                    fields: ["value", "country", "subscale"]
                                },
                            }
                        ],
                        projection: {
                            type: "mercator", scale: 98, center: [0, 40]
                        },
                        mark: {
                            type: "geoshape",
                        },
                        encoding: {
                            color: {
                                field: "value",
                                type: "quantitative",
                                scale: { scheme: "viridis" },
                                legend: { title: null, direction: "horizontal", orient: "bottom-left" }
                            },
                            tooltip: [
                                {
                                    field: "country",
                                    title: "Country",
                                    type: "nominal"
                                },
                                {
                                    field: "value",
                                    title: "Score",
                                    type: "quantitative",
                                    format: ".1f"
                                },
                                {
                                    field: "subscale",
                                    title: "Big Five dimension",
                                    type: "nominal",
                                },
                            ]
                        }
                    }
                ]
            };

        </script>

        <!--show vegalite figures-->
        <script>
            // show vegalite figures only after font is loaded
            var fontLoader = new FontLoader(['Inter-UI-upright'], {
                "fontLoaded": function (f) {
                    console.log("font loaded: " + f.family);
                }, "complete": function (error) {
                    vegaEmbed('#vis1', subscale_radial, { actions: { source: false, compiled: false, editor: false } });
                    vegaEmbed('#vis2', subscale_boxplot, { actions: { source: false, compiled: false, editor: false } }); // https://github.com/vega/vega-embed#options
                    vegaEmbed('#vis3', openness_density, { actions: { source: false, compiled: false, editor: false } });
                    vegaEmbed('#vis4', conscientiousness_density, { actions: { source: false, compiled: false, editor: false } });
                    vegaEmbed('#vis5', extraversion_density, { actions: { source: false, compiled: false, editor: false } });
                    vegaEmbed('#vis6', agreeableness_density, { actions: { source: false, compiled: false, editor: false } });
                    vegaEmbed('#vis7', neuroticism_density, { actions: { source: false, compiled: false, editor: false } });
                    vegaEmbed('#vis8', correlation_heatmap, { actions: { source: false, compiled: false, editor: false } });
                    vegaEmbed('#vis9', global_mean_plot, { actions: { source: false, compiled: false, editor: false } });
                }
            }, 3000);
            fontLoader.loadFonts();
        </script>


        <%- include('../partials/footer_viz') %>

</body>

</html>